<!DOCTYPE html>

<html>

<head>
    <meta charset="UTF-8">
    <title>Canvas</title>

    <style type="text/css">
        canvas {
            border: 1px solid black;
        }
    </style>

</head>

<body>

    <canvas id="canvas"></canvas>

    <script type="text/javascript">
        var noClicks = 0;

        // Gets a handle to the element with id canvasOne.
        var canvas = document.getElementById("canvas");
        // Get a 2D context for the canvas.
        var ctx = canvas.getContext("2d");

        let topPos = canvas.offsetTop;
        let leftPos = canvas.offsetLeft;
        let gravity = 1;

        canvas.width = 900;//canvas length
        canvas.height = 450;//canvas height


        //Create Pacman class
        class Pacman {
            //variables for Pacman
            rotation = 0;
            VerticalMovement = 0;
            HorizontalMovement = 0;
            lastPosX;
            lastPosY;

            //Construtor
            constructor(posX, posY, radius, AnimationSpeed) {
                this.posX = posX;
                this.posY = posY;
                this.radius = radius;
                this.AnimationSpeed = AnimationSpeed;
            }

            //Draw Pacman with Offset Rotation
            draw() {
                if(this.lastPosX == null || this.lastPosY == null){
                    this.lastPosX = this.posX;
                    this.lastPosY = this.posY;
                }
                //Clear Previous Frame with Buffer of Animation Speed and with Reverse Direction
                this.clearCircle(this.lastPosX, this.lastPosY, this.radius + 1);
                //Change Colour Style to rgb yellow
                ctx.fillStyle = "rgb(255, 255, 0)";
                ctx.strokeStyle = "rgb(0,0,0)";
                ctx.beginPath();
                //Draw arc from 325 to 45 degrees with a rotation from constructor
                ctx.arc(this.posX, this.posY, this.radius, -Math.PI / 6 + this.rotation, Math.PI / 6 + this.rotation, true);
                //Draw line to center
                ctx.lineTo(this.posX, this.posY);

                //Get X Co-ordinate of point on arc
                let x = this.radius * Math.cos(-Math.PI / 6 + this.rotation) + this.posX;
                //Get Y Co-Ordinate of point on arc
                let y = this.radius * Math.sin(-Math.PI / 6 + this.rotation) + this.posY;

                //Draw line to Point on arc
                ctx.lineTo(x, y);

                //Render Context
                ctx.fill();
                ctx.stroke();
            }

            //Move Pacman around the screen
            move() {
                //Save Previous X and Y co-ordinates
                this.lastPosX = this.posX;
                this.lastPosY = this.posY;

                //Apply Gravity Before Bounds Check
                // this.VerticalMovement += gravity;

                //Check If Pacman has reached the edge of the canvas on the x-axis
                this.HorizontalMovement = this.posX <= this.radius 
                    ? Math.abs(Math.floor(this.HorizontalMovement*0.9))
                    : (this.posX >= (canvas.width - this.radius) 
                        ? -Math.abs(Math.floor(this.HorizontalMovement*0.9))
                        : this.HorizontalMovement);

                //Check If Pacman has reached the edge of the canvas on the y-axis
                this.VerticalMovement = this.posY <= this.radius 
                    ? Math.abs(Math.floor(this.VerticalMovement*0.9))
                    : (this.posY >= (canvas.height - this.radius) 
                        ? -Math.abs(Math.floor(this.VerticalMovement*0.9))
                        : this.VerticalMovement);

                //Move Pacman with respect to if the Pacman has reached the x-axis
                this.posX += this.HorizontalMovement;
                //Move Pacman with respect to if the Pacman has reached the y-axis
                this.posY += this.VerticalMovement;

                //Rotation Based on Linear Velocity
                // this.rotation = (this.HorizontalMovement >= 1 || this.HorizontalMovement <= -1)? (this.HorizontalMovement >= 1 ? 0 : Math.PI) : (this.VerticalMovement >= 1 ? Math.PI/2 : -Math.PI/2);

                //Rotation Based on Non-Linear Velocity
                let theta = Math.atan2(this.posY - this.lastPosY, this.posX - this.lastPosX);
                this.rotation = theta < 0 ? -Math.abs(theta) : theta - 2 * Math.PI;

                //Rotate Pacman with Respect to Animation Speed and Bounces
                // if (this.rotation % (2 * Math.PI) == 1 || -this.rotation % (2 * Math.PI) == 1) this.rotation = Math.PI / 180;
                // else this.rotation += Math.PI / 180 * this.AnimationSpeed * this.reachedX * this.reachedY;
            }

            //Custom Clear Method
            clearCircle(x,y,radius){
                ctx.beginPath();
                ctx.fillStyle = "rgb(255,255,255)";
                ctx.strokeStyle = "rgb(255,255,255)";
                ctx.arc(x, y, radius, 0, 2*Math.PI);
                ctx.stroke();
                ctx.fill();
            }
        }

        let pacman = new Pacman(canvas.width/2, canvas.height/2, 25, 5);

        //Double Click Event Listener
        canvas.addEventListener("dblclick", function (event) {
            pacman.posX = event.clientX - leftPos;
            pacman.posY = event.clientY - topPos;
            pacman.HorizontalMovement = 0;
            pacman.VerticalMovement = 0;
            pacman.draw();
        });

        document.addEventListener('keydown', function(e){
            switch(e.which){
                case 87:{//W Key Press
                    console.log("Vector Up");
                    //Movement in Linear Fashion
                    // pacman.VerticalMovement = -this.AnimationSpeed;
                    // pacman.HorizontalMovement = 0;

                    //Movement in Non-Linear Fashion
                    pacman.VerticalMovement -= pacman.AnimationSpeed;
                    break;
                }
                case 65:{//A Key Press
                    console.log("Vector Left");
                    //Movement in Linear Fashion
                    // pacman.VerticalMovement = 0;
                    // pacman.HorizontalMovement = -this.AnimationSpeed;

                    //Movement in Non-Linear Fashion
                    pacman.HorizontalMovement -= pacman.AnimationSpeed;
                    break;
                }
                case 83:{//S Key Press
                    console.log("Vector Down");
                    //Movement in Linear Fashion
                    // pacman.VerticalMovement = this.AnimationSpeed;
                    // pacman.HorizontalMovement = 0;

                    //Movement in Non-Linear Fashion
                    pacman.VerticalMovement += pacman.AnimationSpeed;
                    break;
                }
                case 68:{//D Key Press
                    console.log("Vector Right");
                    //Movement in Linear Fashion
                    // pacman.VerticalMovement = 0;
                    // pacman.HorizontalMovement = this.AnimationSpeed;

                    //Movement in Non-Linear Fashion
                    pacman.HorizontalMovement += pacman.AnimationSpeed;
                    break;
                }
            }
        });

        //Allow Animation
        function repeat() {

            pacman.draw();
            pacman.move();

            window.requestAnimationFrame(repeat);
        }

        //Start Animation
        repeat();
    </script>

</body>

</html>